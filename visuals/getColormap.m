function  h = getColormap(h)
numK = h.numK;

if strcmp(h.vis.clrmaptype,'hsv') % use HSV coding, which, in the Value channel includes information from 'lambda' (from ROI stats)    
%     huemap = linspace(0,0.8,numK); % to make a custom hsv map that doesn't include the circular overlap range in magenta-red (by not using range 0 to 1)
%     clrmap = squeeze(hsv2rgb(cat(3, huemap, ones(size(huemap)), ones(size(huemap)))));
    
%     h.vis.huemap = huemap';

    cmap64 = HardCodedHSVnew;
    clrmap = InterpColormap(cmap64,numK);
    
elseif strcmp(h.vis.clrmaptype,'rand')  % use RGB (not tested)
    if h.vis.isFixRandSeed
        rng('default');
    end
    H = horzcat(rand(numK,1),rand(numK,1),0.5+0.5*rand(numK,1));    
    clrmap = hsv2rgb(H);    

elseif strcmp(h.vis.clrmaptype,'jet')  % use RGB (not tested)
    clrmap = flipud(jet(numK));
    
elseif strcmp(h.vis.clrmaptype,'hsv_old') % use HSV coding, which, in the Value channel includes information from 'lambda' (from ROI stats)    
%     huemap = linspace(0,1,numK);
%     clrmap = squeeze(hsv2rgb(cat(3, huemap, ones(size(huemap)), ones(size(huemap)))));
%     h.vis.huemap = huemap';

    clrmap = hsv(round(numK*1.1));
    clrmap = clrmap(1:numK,:);
end

h.vis.clrmap = clrmap;
end


function cmap = InterpColormap(cmap64,numK) % this doesn't work well for very small numK - too close to edge
k = double(numK);
c1 = interp1(1:64,cmap64(:,1),linspace(1,64,k),'pchip');
c2 = interp1(1:64,cmap64(:,2),linspace(1,64,k),'pchip');
c3 = interp1(1:64,cmap64(:,3),linspace(1,64,k),'pchip');
% c1 = interp1(1:64,cmap64(:,1),linspace(1,64,k),'spline');
% c2 = interp1(1:64,cmap64(:,2),linspace(1,64,k),'spline');
% c3 = interp1(1:64,cmap64(:,3),linspace(1,64,k),'spline');
cmap = [c1',c2',c3'];
end

function hsv_new = HardCodedHSVnew()
% 64x3
hsv_new = [1,0.00392156885936856,0.00392156885936856;1,0.0785470232367516,0.00479691894724965;1,0.153043001890183,0.00567226903513074;1,0.227409496903420,0.00654761912301183;1,0.301646500825882,0.00742296921089292;1,0.360205769538879,0.00733893550932407;1,0.418774962425232,0.00725490227341652;1,0.477354049682617,0.00717086857184768;1,0.535943031311035,0.00708683487027884;1,0.594541966915131,0.00700280116870999;1,0.666931807994843,0.00681605981662869;1,0.739348888397217,0.00662931846454740;1,0.811793148517609,0.00644257711246610;1,0.884264647960663,0.00625583576038480;1,0.956763267517090,0.00606909440830350;0.974632441997528,1,0.00588235305622220;0.877609550952911,1,0.00606390740722418;0.780622124671936,1,0.00624546129256487;0.683669984340668,1,0.00642701564356685;0.586753308773041,1,0.00660856952890754;0.489871948957443,1,0.00679012387990952;0.393025994300842,1,0.00697167776525021;0.149237617850304,1,0.00595497479662299;0.00493827182799578,1,0.104923725128174;0.00392156885936856,1,0.347671568393707;0.00424836622551084,1,0.456898301839829;0.00457516359165311,1,0.566053628921509;0.00490196095779538,1,0.675137519836426;0.00522875832393765,1,0.784150004386902;0.00555555569007993,1,0.893091142177582;0.00588235305622220,1,1;0.00613460270687938,0.933770477771759,1;0.00638685189187527,0.865614712238312,1;0.00663910154253244,0.797493517398834,1;0.00689135072752833,0.729406833648682,1;0.00714360037818551,0.661354720592499,1;0.00739584956318140,0.593337118625641,1;0.00764809921383858,0.525354087352753,1;0.00790034886449575,0.457405626773834,1;0.00815259758383036,0.389491677284241,1;0.00840484723448753,0.321612298488617,1;0.00797706376761198,0.245469674468040,1;0.00754927983507514,0.169261768460274,1;0.00712149590253830,0.0929885804653168,1;0.00669371197000146,0.0166500974446535,1;0.0934257209300995,0.00658102333545685,1;0.190136045217514,0.00646833470091224,1;0.286868274211884,0.00635564560070634,1;0.344540268182755,0.00600792048498988,1;0.402252703905106,0.00566019536927342,1;0.460005611181259,0.00531246978789568,1;0.517798900604248,0.00496474467217922,1;0.575632691383362,0.00461701909080148,1;0.633506953716278,0.00426929397508502,1;0.691421627998352,0.00392156885936856,1;0.752168893814087,0.0123464772477746,1;0.811926484107971,0.0207713861018419,1;0.870694398880005,0.0291962940245867,1;0.928472638130188,0.0376212038099766,1;0.985261201858521,0.0460461117327213,1;1,0.0544710196554661,0.962861537933350;1,0.0628959313035011,0.908052384853363;1,0.0863499268889427,0.745890676975250;1,0.109803922474384,0.592156946659088];
end
